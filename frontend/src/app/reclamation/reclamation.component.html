<div class="container">
  <h2>All Reclamations</h2>
  
  <!-- Filter Section -->
  <div class="filter-section">
    <div class="filter-group">
      <label>Filter by Title:</label>
      <input [(ngModel)]="titleFilter" (input)="filterByTitle()" placeholder="Search by title...">
    </div>
  </div>
  <span>
  <div class="stats-section" [hidden]="!reclamations.length">
    <h3>Reclamation Types Overview</h3>
    <canvas #pieChart class="stats-chart"></canvas>
  </div>
</span>
  <!-- Add/Cancel Button -->
  <button [class.btn-add]="!selectedReclamation" [class.btn-cancel]="selectedReclamation" (click)="toggleReclamationForm()">
    {{ selectedReclamation ? 'Cancel' : 'Add Reclamation' }}
  </button>

  <!-- Form Modal -->
  <div *ngIf="selectedReclamation" class="form-modal">
    <div class="modal-content">
      <h3>{{ selectedReclamation.id ? 'Edit' : 'Add' }} Reclamation</h3>
      <div class="form-group">
        <label>Title:</label>
        <input [(ngModel)]="selectedReclamation.titre">
      </div>
      <div class="form-group">
        <label>Description:</label>
        <textarea [(ngModel)]="selectedReclamation.description"></textarea>
      </div>
      <div class="form-group">
        <label>Type:</label>
        <select [(ngModel)]="selectedReclamation.type">
          <option value="URGENT">Urgent</option>
          <option value="CLASSIC">Classic</option>
          <option value="SECONDARY">Secondary</option>
          <option value="FIRSTCLASS">First Class</option>
        </select>
      </div>
      <div class="form-group">
        <label>Don:</label>
        <select [(ngModel)]="selectedDonId">
          <option [ngValue]="null">Select a Don</option>
          <option *ngFor="let don of dons" [ngValue]="don.id">{{ don.titre }}</option>
        </select>
      </div>
      <div class="form-group">
        <label>Upload Image:</label>
        <input type="file" (change)="onFileSelected($event)" accept="image/*">
      </div>
      <div class="form-actions">
        <button class="btn-cancel" (click)="toggleReclamationForm()">Cancel</button>
        <button class="btn-submit" (click)="selectedReclamation.id ? updateReclamation() : addReclamation()">
          {{ selectedReclamation.id ? 'Update' : 'Create' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Reclamations Table -->
  <table class="don-table" *ngIf="filteredReclamations.length">
    <thead>
      <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Type</th>
        <th>Image</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of paginatedReclamations">
        <td>{{ r.titre }}</td>
        <td>{{ r.description }}</td>
        <td><span class="status {{ r.type.toLowerCase() }}">{{ r.type }}</span></td>
        <td><img *ngIf="r.imageUrl" [src]="r.imageUrl" class="thumb"></td>
        <td>
          <button class="btn-edit" (click)="selectForEdit(r)">Edit</button>
          <button class="btn-delete" (click)="openDeleteModal(r)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
  
  <!-- No results message -->
  <div class="no-results" *ngIf="!filteredReclamations.length && !isLoading">
    No records found matching your criteria.
  </div>
  
  <!-- Pagination Controls -->
  <div class="pagination-controls" *ngIf="filteredReclamations.length > 0">
    <button 
      [disabled]="currentPage === 1" 
      (click)="goToPage(currentPage - 1)" 
      class="btn-pagination">&laquo; Previous</button>
    
    <div class="page-numbers">
      <button 
        *ngFor="let page of [].constructor(totalPages); let i = index" 
        (click)="goToPage(i + 1)" 
        class="btn-page" 
        [class.active]="currentPage === i + 1">
        {{ i + 1 }}
      </button>
    </div>
    
    <button 
      [disabled]="currentPage === totalPages" 
      (click)="goToPage(currentPage + 1)" 
      class="btn-pagination">Next &raquo;</button>
  </div>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteModal" class="modal-overlay">
    <div class="delete-modal">
      <p>Delete "{{ reclamationToDelete?.titre }}"?</p>
      <button class="btn-cancel" (click)="closeDeleteModal()" [disabled]="isDeleting">Cancel</button>
      <button class="btn-delete" (click)="confirmDelete()" [disabled]="isDeleting">Delete</button>
    </div>
  </div>
</div>
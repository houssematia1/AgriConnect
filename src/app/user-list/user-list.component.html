<div class="layout">
  <!-- Contenu principal -->
  <div class="main-content">
    <div class="user-list-wrapper">
      <div class="list-header">
        <h2>AgriConnect User List</h2>
        <button class="btn-primary" (click)="onAddUser()">+ Ajouter</button>
        <button class="btn logout" (click)="onLogout()">‚éã D√©connexion</button>
      </div>

      <div class="filters">
        <input
          type="text"
          placeholder="üîç Rechercher..."
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearch()" />
        <select [(ngModel)]="selectedRole" (change)="onRoleChange()">
          <option value="all">Tous les r√¥les</option>
          <option value="admin">Admin</option>
          <option value="user">Client</option>
          <option value="agriculteur">Agriculteur</option>
          <option value="livreur">Livreur</option>
        </select>
      </div>

      <div class="table-container">
        <table class="styled-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Utilisateur</th>
              <th>Email</th>
              <th>R√¥le</th>
              <th>√âtat</th>
              <th>Risque IA</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users; index as i">
              <td>{{ i + 1 }}</td>
              <td class="user-cell">
                <img class="avatar"
                     src="https://ui-avatars.com/api/?name={{ user.nom }}+{{ user.prenom }}&background=0D8ABC&color=fff"
                     alt="avatar" />
                <div>
                  <div class="name">{{ user.nom }} {{ user.prenom }}</div>
                </div>
              </td>
              <td>{{ user.email }}</td>
              <td><span class="role-badge">{{ user.role }}</span></td>
              <td>
                <span [style.color]="user.isBlocked ? 'red' : 'green'">
                  {{ user.isBlocked ? 'Bloqu√©' : 'Actif' }}
                </span>
              </td>
              <td>
                <span *ngIf="user.risk_score !== undefined"
                      [ngStyle]="{
                        color: user.risk_score >= 70 ? 'red' :
                               user.risk_score >= 40 ? 'orange' : 'green',
                        fontWeight: 'bold'
                      }">
                  {{ user.risk_score }} %
                </span>
                <span *ngIf="user.risk_score === undefined">‚è≥</span>
              </td>
              <td>
                <button class="action-btn edit" (click)="onUpdateUser(user)">Modifier</button>
                <button class="action-btn delete" (click)="onDeleteUser(user)">Supprimer</button>
                <button class="action-btn block" *ngIf="!user.isBlocked" (click)="onBlockUser(user)">Bloquer</button>
                <button class="action-btn unblock" *ngIf="user.isBlocked" (click)="onUnblockUser(user)">D√©bloquer</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="list-footer">
        <span>Affichage de {{ users.length }} utilisateurs</span>
        <div class="pagination">
          <button (click)="prevPage()" [disabled]="page === 1">‚Üê</button>
          <button *ngFor="let p of pages" [class.active]="p === page" (click)="goToPage(p)">
            {{ p }}
          </button>
          <button (click)="nextPage()" [disabled]="page === pages.length">‚Üí</button>
        </div>
      </div>
    </div>
  </div>
</div>
